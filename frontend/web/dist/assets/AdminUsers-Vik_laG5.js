import{a as e,c as t,d as n,i as r,l as i,n as a,r as o,t as s}from"./index-ASG9tztn.js";var c=n(i()),l=n(t()),u=[`user`,`expert`,`moderator`,`admin`],d={user:`Người dùng`,expert:`Chuyên gia`,moderator:`Điều phối`,admin:`Quản trị`};function f(){let[t,n]=(0,c.useState)([]),[i,f]=(0,c.useState)(0),[p,m]=(0,c.useState)(1),[h]=(0,c.useState)(10),[g,_]=(0,c.useState)(``),[v,y]=(0,c.useState)(``),[b,x]=(0,c.useState)(!1),[S,C]=(0,c.useState)(!1),[w,T]=(0,c.useState)(null),[E,D]=(0,c.useState)(!1),[O,k]=(0,c.useState)(null),A=(0,c.useCallback)(async()=>{C(!0),k(null);try{let e=await s.list({q:g||void 0,role:v||void 0,page:p,limit:h,includeDeleted:b});e?.items&&(n(e.items),f(e.total||0))}catch(e){k(e.message||`Load failed`)}finally{C(!1)}},[g,v,p,h,b]);(0,c.useEffect)(()=>{A()},[A]);let j=async e=>{D(!0),T(null);try{let t=await s.detail(e);T(t)}catch(e){k(e.message)}finally{D(!1)}},M=async(e,r)=>{let i=[...t];n(t.map(t=>t._id===e?{...t,role:r}:t));try{await s.updateRole(e,r),A()}catch(e){n(i),alert(e.response?.data?.message||e.message||`Đổi role thất bại`)}},N=async e=>{if(window.confirm(`Xác nhận xoá mềm người dùng này?`))try{await s.softDelete(e),A()}catch(e){alert(e.response?.data?.message||e.message||`Xoá thất bại`)}},P=async e=>{try{await s.restore(e),A()}catch(e){alert(e.response?.data?.message||e.message||`Khôi phục thất bại`)}};return Math.ceil(i/h),(0,l.jsxs)(e,{children:[(0,l.jsxs)(`div`,{className:`mb-3 d-flex justify-content-between align-items-center flex-wrap gap-2`,children:[(0,l.jsxs)(`div`,{children:[(0,l.jsx)(`h2`,{className:`h5 mb-0`,children:`Người dùng`}),(0,l.jsx)(`small`,{className:`text-muted`,children:`Quản lý danh sách người dùng hệ thống`})]}),(0,l.jsxs)(`div`,{className:`text-muted small`,children:[`Tổng: `,(0,l.jsx)(`strong`,{children:i})]})]}),(0,l.jsxs)(`div`,{className:`d-flex align-items-center mb-3`,style:{gap:12,flexWrap:`wrap`},children:[(0,l.jsxs)(`div`,{style:{display:`inline-flex`,alignItems:`center`,gap:6},children:[(0,l.jsx)(`input`,{className:`form-control form-control-sm`,placeholder:`Tìm username hoặc email`,value:g,onChange:e=>{_(e.target.value),m(1)},style:{width:240,minWidth:140}}),(0,l.jsx)(`button`,{className:`btn btn-sm`,title:`Xóa tìm kiếm`,onClick:()=>{_(``),m(1)},style:{padding:0,width:34,height:34,display:`inline-flex`,alignItems:`center`,justifyContent:`center`,borderRadius:6,border:`1px solid #ced4da`,background:`#fff`},"aria-label":`clear-search`,children:(0,l.jsx)(r,{size:14})})]}),(0,l.jsxs)(`select`,{className:`form-select form-select-sm`,value:v,onChange:e=>{y(e.target.value),m(1)},style:{width:160,minWidth:140},children:[(0,l.jsx)(`option`,{value:``,children:`-- Role --`}),u.map(e=>(0,l.jsx)(`option`,{value:e,children:e},e))]}),(0,l.jsxs)(`label`,{className:`d-flex align-items-center gap-1 small`,style:{margin:0},children:[(0,l.jsx)(`input`,{id:`includeDeleted`,className:`form-check-input`,type:`checkbox`,checked:b,onChange:e=>{x(e.target.checked),m(1)},style:{width:16,height:16}}),(0,l.jsx)(`span`,{children:`Hiển thị đã xóa`})]})]}),O&&(0,l.jsx)(`div`,{className:`alert alert-danger py-1 small mb-2`,children:O}),(0,l.jsx)(`div`,{className:`table-responsive bg-white shadow-sm rounded border`,children:(0,l.jsxs)(`table`,{className:`table table-sm table-hover mb-0`,children:[(0,l.jsx)(`thead`,{className:`table-light`,children:(0,l.jsxs)(`tr`,{children:[(0,l.jsx)(`th`,{style:{width:60},children:`STT`}),(0,l.jsx)(`th`,{children:`Tên đăng nhập`}),(0,l.jsx)(`th`,{children:`Email`}),(0,l.jsx)(`th`,{children:`Vai trò`}),(0,l.jsx)(`th`,{children:`Trạng thái`}),(0,l.jsx)(`th`,{style:{width:150},children:`Hành động`})]})}),(0,l.jsxs)(`tbody`,{children:[S&&(0,l.jsx)(`tr`,{children:(0,l.jsx)(`td`,{colSpan:6,className:`text-center py-4`,children:`Đang tải...`})}),!S&&t.length===0&&(0,l.jsx)(`tr`,{children:(0,l.jsx)(`td`,{colSpan:6,className:`text-center py-4`,children:`Không có dữ liệu`})}),!S&&t.map((e,t)=>(0,l.jsxs)(`tr`,{className:e.isDeleted?`table-danger`:``,children:[(0,l.jsx)(`td`,{className:`small text-muted`,children:(p-1)*h+t+1}),(0,l.jsx)(`td`,{children:(0,l.jsx)(`button`,{className:`btn btn-link btn-sm p-0`,onClick:()=>j(e._id),children:e.username})}),(0,l.jsx)(`td`,{className:`small`,children:e.email}),(0,l.jsx)(`td`,{children:(0,l.jsx)(`select`,{className:`form-select form-select-sm`,value:e.role,onChange:t=>M(e._id,t.target.value),disabled:e.isDeleted,children:u.map(e=>(0,l.jsx)(`option`,{value:e,children:d[e]||e},e))})}),(0,l.jsx)(`td`,{className:`small`,children:e.isDeleted?(0,l.jsx)(`span`,{className:`badge bg-danger`,children:`Đã xóa`}):(0,l.jsx)(`span`,{className:`badge bg-success`,children:`Hoạt động`})}),(0,l.jsx)(`td`,{children:(0,l.jsx)(`div`,{style:{display:`inline-flex`,alignItems:`center`,gap:6},children:e.isDeleted?(0,l.jsx)(`button`,{className:`btn btn-sm btn-link`,title:`Khôi phục`,onClick:()=>P(e._id),"aria-label":`restore-${e._id}`,style:{color:`#1890ff`,padding:4,margin:0,lineHeight:1},children:(0,l.jsx)(a,{size:16})}):(0,l.jsx)(`button`,{className:`btn btn-sm btn-link`,title:`Xóa`,onClick:()=>N(e._id),"aria-label":`delete-${e._id}`,style:{color:`#FF4D4F`,padding:4,margin:0,lineHeight:1},children:(0,l.jsx)(o,{size:16})})})})]},e._id))]})]})}),(0,l.jsxs)(`div`,{className:`d-flex justify-content-between align-items-center mt-3`,children:[(0,l.jsxs)(`div`,{className:`text-muted small`,children:[`Tổng: `,i,` mục`]}),(0,l.jsx)(`nav`,{children:(0,l.jsx)(`ul`,{className:`pagination pagination-sm mb-0`,children:(()=>{let e=Math.max(1,Math.ceil(i/h)),t=[],n=Math.max(1,p-2),r=Math.min(e,p+2);n>1&&(t.push(1),n>2&&t.push(`...`));for(let e=n;e<=r;e++)t.push(e);return r<e&&(r<e-1&&t.push(`...`),t.push(e)),[(0,l.jsx)(`li`,{className:`page-item ${p<=1?`disabled`:``}`,children:(0,l.jsx)(`button`,{className:`page-link`,onClick:()=>p>1&&m(p-1),children:`Trước`})},`prev`),t.map((e,t)=>typeof e==`number`?(0,l.jsx)(`li`,{className:`page-item ${e===p?`active`:``}`,children:(0,l.jsx)(`button`,{className:`page-link`,onClick:()=>m(e),children:e})},e):(0,l.jsx)(`li`,{className:`page-item disabled`,children:(0,l.jsx)(`span`,{className:`page-link`,children:e})},`dot-${t}`)),(0,l.jsx)(`li`,{className:`page-item ${p>=e?`disabled`:``}`,children:(0,l.jsx)(`button`,{className:`page-link`,onClick:()=>p<e&&m(p+1),children:`Tiếp`})},`next`)]})()})})]}),w&&(0,l.jsx)(`div`,{className:`modal d-block`,tabIndex:`-1`,role:`dialog`,onClick:()=>T(null),children:(0,l.jsx)(`div`,{className:`modal-dialog`,role:`document`,onClick:e=>e.stopPropagation(),children:(0,l.jsxs)(`div`,{className:`modal-content`,children:[(0,l.jsxs)(`div`,{className:`modal-header`,children:[(0,l.jsx)(`h5`,{className:`modal-title`,children:`Chi tiết người dùng`}),(0,l.jsx)(`button`,{type:`button`,className:`btn-close`,onClick:()=>T(null)})]}),(0,l.jsxs)(`div`,{className:`modal-body small`,children:[E&&(0,l.jsx)(`div`,{children:`Đang tải...`}),!E&&w&&(0,l.jsxs)(`div`,{className:`vstack gap-1`,children:[(0,l.jsxs)(`div`,{children:[(0,l.jsx)(`strong`,{children:`Tên đăng nhập:`}),` `,w.username]}),(0,l.jsxs)(`div`,{children:[(0,l.jsx)(`strong`,{children:`Email:`}),` `,w.email]}),(0,l.jsxs)(`div`,{children:[(0,l.jsx)(`strong`,{children:`Vai trò:`}),` `,d[w.role]||w.role]}),(0,l.jsxs)(`div`,{children:[(0,l.jsx)(`strong`,{children:`Đã xác minh:`}),` `,w.isVerified?`Có`:`Không`]}),(0,l.jsxs)(`div`,{children:[(0,l.jsx)(`strong`,{children:`Trạng thái:`}),` `,w.isDeleted?`Đã xóa`:`Hoạt động`]}),(0,l.jsxs)(`div`,{children:[(0,l.jsx)(`strong`,{children:`Tạo lúc:`}),` `,new Date(w.createdAt).toLocaleString()]}),(0,l.jsxs)(`div`,{children:[(0,l.jsx)(`strong`,{children:`Cập nhật:`}),` `,new Date(w.updatedAt).toLocaleString()]})]})]}),(0,l.jsx)(`div`,{className:`modal-footer`,children:(0,l.jsx)(`button`,{type:`button`,className:`btn btn-secondary`,onClick:()=>T(null),children:`Đóng`})})]})})})]})}export{f as default};