import React from "react";

// Step 2: Stages Setup
export const Step2Stages = ({ stages, addStage, updateStage, removeStage }) => (
  <div className="step-stages">
    <div className="step-header">
      <h2>Giai ƒëo·∫°n ph√°t tri·ªÉn</h2>
      <p className="hint">Template c·∫ßn c√≥ √≠t nh·∫•t 3 giai ƒëo·∫°n</p>
    </div>

    {stages.map((stage, index) => (
      <div key={index} className="stage-card">
        <div className="stage-card-header">
          <h3>Giai ƒëo·∫°n {stage.stage_number}</h3>
          {stages.length > 3 && (
            <button
              type="button"
              className="btn-icon btn-danger"
              onClick={() => removeStage(index)}
              title="X√≥a giai ƒëo·∫°n"
            >
              üóëÔ∏è
            </button>
          )}
        </div>

        <div className="form-row">
          <div className="form-group flex-1">
            <label>
              T√™n giai ƒëo·∫°n <span className="required">*</span>
            </label>
            <input
              type="text"
              className="form-input"
              placeholder="V√≠ d·ª•: N·∫£y m·∫ßm"
              value={stage.name}
              onChange={(e) => updateStage(index, "name", e.target.value)}
            />
          </div>
        </div>

        <div className="form-group">
          <label>M√¥ t·∫£ giai ƒëo·∫°n</label>
          <textarea
            className="form-textarea"
            rows="2"
            placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ giai ƒëo·∫°n n√†y..."
            value={stage.description}
            onChange={(e) => updateStage(index, "description", e.target.value)}
          />
        </div>

        <div className="form-row">
          <div className="form-group">
            <label>
              Ng√†y b·∫Øt ƒë·∫ßu <span className="required">*</span>
            </label>
            <input
              type="number"
              className="form-input"
              min="1"
              value={stage.day_start}
              onChange={(e) =>
                updateStage(index, "day_start", parseInt(e.target.value))
              }
            />
          </div>

          <div className="form-group">
            <label>
              Ng√†y k·∫øt th√∫c <span className="required">*</span>
            </label>
            <input
              type="number"
              className="form-input"
              min={stage.day_start + 1}
              value={stage.day_end}
              onChange={(e) =>
                updateStage(index, "day_end", parseInt(e.target.value))
              }
            />
          </div>

          <div className="form-group">
            <label>T·ªïng ng√†y</label>
            <div className="form-static">
              {stage.day_end - stage.day_start + 1} ng√†y
            </div>
          </div>
        </div>

        <div className="form-group">
          <label>·∫¢nh m·∫´u giai ƒëo·∫°n (URL)</label>
          <input
            type="text"
            className="form-input"
            placeholder="https://example.com/stage-image.jpg"
            value={stage.stage_image || ""}
            onChange={(e) => updateStage(index, "stage_image", e.target.value)}
          />
          {stage.stage_image && (
            <div className="image-preview">
              <img
                src={stage.stage_image}
                alt={`Stage ${stage.stage_number}`}
              />
            </div>
          )}
        </div>
      </div>
    ))}

    <button
      type="button"
      className="btn btn-outline btn-block"
      onClick={addStage}
    >
      + Th√™m giai ƒëo·∫°n
    </button>
  </div>
);

// Step 3: Tasks (Autogenerated Tasks)
export const Step3Tasks = ({
  stages,
  addTaskToStage,
  updateTask,
  removeTask,
}) => (
  <div className="step-tasks">
    <div className="step-header">
      <h2>Nhi·ªám v·ª• t·ª± ƒë·ªông</h2>
      <p className="hint">
        C√°c nhi·ªám v·ª• n√†y s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông sinh ra cho ng∆∞·ªùi d√πng m·ªói ng√†y
      </p>
    </div>

    {stages.map((stage, stageIndex) => (
      <div key={stageIndex} className="stage-section">
        <div className="stage-section-header">
          <h3>
            Giai ƒëo·∫°n {stage.stage_number}: {stage.name}
          </h3>
          <span className="badge">
            {stage.autogenerated_tasks?.length || 0} nhi·ªám v·ª•
          </span>
        </div>

        {stage.autogenerated_tasks?.map((task, taskIndex) => (
          <div key={taskIndex} className="task-card">
            <div className="task-card-header">
              <span className="task-number">Nhi·ªám v·ª• {taskIndex + 1}</span>
              <button
                type="button"
                className="btn-icon btn-sm"
                onClick={() => removeTask(stageIndex, taskIndex)}
              >
                √ó
              </button>
            </div>

            <div className="form-row">
              <div className="form-group flex-2">
                <label>T√™n nhi·ªám v·ª•</label>
                <input
                  type="text"
                  className="form-input"
                  placeholder="V√≠ d·ª•: T∆∞·ªõi n∆∞·ªõc"
                  value={task.task_name}
                  onChange={(e) =>
                    updateTask(
                      stageIndex,
                      taskIndex,
                      "task_name",
                      e.target.value
                    )
                  }
                />
              </div>

              <div className="form-group flex-1">
                <label>T·∫ßn su·∫•t</label>
                <select
                  className="form-select"
                  value={task.frequency}
                  onChange={(e) =>
                    updateTask(
                      stageIndex,
                      taskIndex,
                      "frequency",
                      e.target.value
                    )
                  }
                >
                  <option value="daily">H√†ng ng√†y</option>
                  <option value="every_2_days">2 ng√†y/l·∫ßn</option>
                  <option value="every_3_days">3 ng√†y/l·∫ßn</option>
                  <option value="weekly">H√†ng tu·∫ßn</option>
                </select>
              </div>

              <div className="form-group flex-1">
                <label>ƒê·ªô ∆∞u ti√™n</label>
                <select
                  className="form-select"
                  value={task.priority}
                  onChange={(e) =>
                    updateTask(
                      stageIndex,
                      taskIndex,
                      "priority",
                      e.target.value
                    )
                  }
                >
                  <option value="low">Th·∫•p</option>
                  <option value="medium">Trung b√¨nh</option>
                  <option value="high">Cao</option>
                </select>
              </div>
            </div>

            <div className="form-group">
              <label>M√¥ t·∫£</label>
              <textarea
                className="form-textarea"
                rows="2"
                placeholder="M√¥ t·∫£ chi ti·∫øt nhi·ªám v·ª•..."
                value={task.description}
                onChange={(e) =>
                  updateTask(
                    stageIndex,
                    taskIndex,
                    "description",
                    e.target.value
                  )
                }
              />
            </div>

            <div className="form-group">
              <label>·∫¢nh minh h·ªça (URL)</label>
              <input
                type="text"
                className="form-input"
                placeholder="https://example.com/task-image.jpg"
                value={task.illustration_image || ""}
                onChange={(e) =>
                  updateTask(
                    stageIndex,
                    taskIndex,
                    "illustration_image",
                    e.target.value
                  )
                }
              />
            </div>
          </div>
        ))}

        <button
          type="button"
          className="btn btn-outline btn-sm"
          onClick={() => addTaskToStage(stageIndex)}
        >
          + Th√™m nhi·ªám v·ª•
        </button>
      </div>
    ))}
  </div>
);

// Step 4: Observations
export const Step4Observations = ({
  stages,
  addObservationToStage,
  updateObservation,
  removeObservation,
}) => (
  <div className="step-observations">
    <div className="step-header">
      <h2>ƒêi·ªÅu ki·ªán quan s√°t</h2>
      <p className="hint">
        C√°c ƒëi·ªÅu ki·ªán quan s√°t nh·ªã ph√¢n (C√≥/Kh√¥ng) ƒë·ªÉ x√°c ƒë·ªãnh chuy·ªÉn giai ƒëo·∫°n
      </p>
    </div>

    {stages.map((stage, stageIndex) => (
      <div key={stageIndex} className="stage-section">
        <div className="stage-section-header">
          <h3>
            Giai ƒëo·∫°n {stage.stage_number}: {stage.name}
          </h3>
          <span className="badge">
            {stage.observation_required?.length || 0} ƒëi·ªÅu ki·ªán
          </span>
        </div>

        {stage.observation_required?.map((obs, obsIndex) => (
          <div key={obsIndex} className="observation-card">
            <div className="observation-card-header">
              <span className="obs-number">ƒêi·ªÅu ki·ªán {obsIndex + 1}</span>
              <button
                type="button"
                className="btn-icon btn-sm"
                onClick={() => removeObservation(stageIndex, obsIndex)}
              >
                √ó
              </button>
            </div>

            <div className="form-row">
              <div className="form-group flex-1">
                <label>Key (ƒë·ªãnh danh)</label>
                <input
                  type="text"
                  className="form-input"
                  placeholder="V√≠ d·ª•: has_sprout"
                  value={obs.key}
                  onChange={(e) =>
                    updateObservation(
                      stageIndex,
                      obsIndex,
                      "key",
                      e.target.value
                    )
                  }
                />
                <small className="hint">D√πng snake_case, kh√¥ng d·∫•u</small>
              </div>

              <div className="form-group flex-1">
                <label>C√¢u h·ªèi hi·ªÉn th·ªã</label>
                <input
                  type="text"
                  className="form-input"
                  placeholder="V√≠ d·ª•: ƒê√£ n·∫£y m·∫ßm?"
                  value={obs.label}
                  onChange={(e) =>
                    updateObservation(
                      stageIndex,
                      obsIndex,
                      "label",
                      e.target.value
                    )
                  }
                />
              </div>
            </div>

            <div className="form-group">
              <label>M√¥ t·∫£</label>
              <input
                type="text"
                className="form-input"
                placeholder="M√¥ t·∫£ chi ti·∫øt ƒë·ªÉ user d·ªÖ quan s√°t"
                value={obs.description}
                onChange={(e) =>
                  updateObservation(
                    stageIndex,
                    obsIndex,
                    "description",
                    e.target.value
                  )
                }
              />
            </div>
          </div>
        ))}

        <button
          type="button"
          className="btn btn-outline btn-sm"
          onClick={() => addObservationToStage(stageIndex)}
        >
          + Th√™m ƒëi·ªÅu ki·ªán quan s√°t
        </button>
      </div>
    ))}
  </div>
);

// Step 5: Rules & Review
export const Step5Review = ({
  formData,
  handleRuleChange,
  handleInputChange,
}) => (
  <div className="step-review">
    <div className="step-header">
      <h2>Quy t·∫Øc & X√°c nh·∫≠n</h2>
    </div>

    <div className="section">
      <h3>Quy t·∫Øc x·ª≠ l√Ω tr·ªÖ h·∫°n</h3>

      <div className="form-row">
        <div className="form-group">
          <label>S·ªë ng√†y cho ph√©p tr·ªÖ</label>
          <input
            type="number"
            className="form-input"
            min="0"
            value={formData.rules.safe_delay_days}
            onChange={(e) =>
              handleRuleChange("safe_delay_days", parseInt(e.target.value))
            }
          />
          <small className="hint">
            N·∫øu user tr·ªÖ qu√° s·ªë ng√†y n√†y, h·ªá th·ªëng s·∫Ω c·∫£nh b√°o
          </small>
        </div>

        <div className="form-group">
          <label>S·ªë ng√†y c·∫£nh b√°o</label>
          <input
            type="number"
            className="form-input"
            min="0"
            value={formData.rules.warning_days}
            onChange={(e) =>
              handleRuleChange("warning_days", parseInt(e.target.value))
            }
          />
          <small className="hint">C·∫£nh b√°o user khi tr·ªÖ t·ª´ ng√†y n√†y</small>
        </div>
      </div>

      <div className="form-group">
        <label className="checkbox-label">
          <input
            type="checkbox"
            checked={formData.rules.auto_skip}
            onChange={(e) => handleRuleChange("auto_skip", e.target.checked)}
          />
          <span>T·ª± ƒë·ªông skip giai ƒëo·∫°n n·∫øu qu√° tr·ªÖ</span>
        </label>
      </div>
    </div>

    <div className="section">
      <h3>Tr·∫°ng th√°i & Ghi ch√∫</h3>

      <div className="form-group">
        <label>Tr·∫°ng th√°i</label>
        <select
          className="form-select"
          value={formData.status}
          onChange={(e) => handleInputChange("status", e.target.value)}
        >
          <option value="draft">Nh√°p (Draft)</option>
          <option value="active">Ho·∫°t ƒë·ªông (Active)</option>
        </select>
      </div>

      <div className="form-group">
        <label>Ghi ch√∫</label>
        <textarea
          className="form-textarea"
          rows="3"
          placeholder="Ghi ch√∫ th√™m v·ªÅ template n√†y..."
          value={formData.notes}
          onChange={(e) => handleInputChange("notes", e.target.value)}
        />
      </div>
    </div>

    <div className="section">
      <h3>T·ªïng quan Template</h3>
      <div className="summary-grid">
        <div className="summary-item">
          <div className="summary-label">T√™n template</div>
          <div className="summary-value">{formData.template_name}</div>
        </div>
        <div className="summary-item">
          <div className="summary-label">Nh√≥m c√¢y</div>
          <div className="summary-value">{formData.plant_group}</div>
        </div>
        <div className="summary-item">
          <div className="summary-label">S·ªë giai ƒëo·∫°n</div>
          <div className="summary-value">{formData.stages.length}</div>
        </div>
        <div className="summary-item">
          <div className="summary-label">T·ªïng ng√†y</div>
          <div className="summary-value">
            {formData.stages.length > 0
              ? Math.max(...formData.stages.map((s) => s.day_end))
              : 0}{" "}
            ng√†y
          </div>
        </div>
        <div className="summary-item">
          <div className="summary-label">T·ªïng nhi·ªám v·ª•</div>
          <div className="summary-value">
            {formData.stages.reduce(
              (sum, stage) => sum + (stage.autogenerated_tasks?.length || 0),
              0
            )}
          </div>
        </div>
        <div className="summary-item">
          <div className="summary-label">T·ªïng ƒëi·ªÅu ki·ªán</div>
          <div className="summary-value">
            {formData.stages.reduce(
              (sum, stage) => sum + (stage.observation_required?.length || 0),
              0
            )}
          </div>
        </div>
      </div>
    </div>
  </div>
);
